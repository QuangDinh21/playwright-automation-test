# Playwright BDD with playwright-bdd

This project uses Playwright with BDD (Behavior-Driven Development) using `playwright-bdd` for end-to-end testing.

## Project Structure

```
.
├── src/
│   ├── features/              # Gherkin feature files (.feature)
│   │   └── loginAndLogout.feature
│   ├── steps/                 # Step definition implementations
│   │   ├── given.ts          # Given step definitions
│   │   ├── when.ts           # When step definitions
│   │   └── then.ts           # Then step definitions
│   └── tests/                 # Test fixtures and configuration
│       └── fixtures.ts        # Playwright fixtures with extension setup
├── extensions/               # Chrome extension files
├── playwright.config.ts       # Playwright and BDD configuration
└── package.json
```

## Setup

1. Install dependencies:

```bash
npm install
```

2. Download and unpack the extension:

```bash
npm run download:gu-wallet
```

## Running Tests

Run all BDD tests:

```bash
npm test
```

Run tests with browser visible (headed mode):

```bash
npm run test:headed
```

## Writing Tests

### Feature Files

Feature files are written in Gherkin syntax and located in `src/features/`:

```gherkin
Feature: Login and Logout
  Scenario: User logs in successfully
    Given I navigate to the wallet popup
    When I complete the wallet setup wizard
    Then I should see the wallet dashboard
```

### Step Definitions

Step definitions implement the steps from feature files and are located in `src/steps/`:

- `given.ts` - Contains all `Given` step definitions and hooks (`Before`, `After`)
- `when.ts` - Contains all `When` step definitions
- `then.ts` - Contains all `Then` step definitions

Example step definition:

```typescript
import { createBdd } from "playwright-bdd";
import { test } from "../tests/fixtures";

const { Given } = createBdd(test);

Given(
  "I navigate to the wallet popup",
  async ({ extensionId, focusLastPage }) => {
    const currentPage = await focusLastPage();
    await currentPage.goto(`chrome-extension://${extensionId}/popup.html`);
  }
);
```

### Fixtures

The `src/tests/fixtures.ts` file provides custom Playwright fixtures:

- `context` - Browser context with extension loaded
- `page` - First page in the context
- `extensionId` - Chrome extension ID
- `lastPage` - Last opened page
- `focusLastPage()` - Helper to focus the last page
- `focusWindowByUrl()` - Helper to focus window by URL

## Configuration

- **Playwright & BDD config**: `playwright.config.ts` - Contains both Playwright and BDD configuration via `defineBddConfig()`
- **TypeScript config**: `tsconfig.json`

## Reports

Test reports are generated by Playwright:

- HTML report: Generated in `playwright-report/` directory (run `npx playwright show-report` to view)
